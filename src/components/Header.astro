---
// src/components/Header.astro
// Coordinador principal de la navegación.
// Usa Alpine.js para el estado y delega la renderización a componentes modulares.
import { Icon } from "astro-icon/components";
import SearchInput from "./navigation/SearchInput.astro"; // Componente modular de input
import MobileDropdowns from "./MobileDropdowns.astro"; // Componente modular de desplegables móviles

interface Props {
  cartItemCount?: number;
}

const { cartItemCount = 3 } = Astro.props;

const navLinks = [
  { title: "Inicio", href: "/" },
  { title: "Productos", href: "/products" },
];
---

<!-- Carga de Alpine.js (muy ligero, solo para esta interactividad) -->
<script
  src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
  is:inline></script>

<header
  class="sticky top-0 z-50 bg-white shadow-md"
  x-data="{ isMenuOpen: false, isSearchOpen: false }"
>
  <!-- Contenedor Principal (Barra Superior Fija) -->
  <div class="container mx-auto px-4 py-3 flex items-center justify-between">
    <!-- 1. Logo de la Tienda -->
    <div class="flex items-center">
      <a
        href="/"
        class="flex items-center gap-2 text-xl font-bold text-gray-900 transition-all duration-300 ease-in-out hover:text-primary hover:scale-105"
      >
        <Icon name="mdi:storefront" class="w-8 h-8 text-primary" />
        <span class="hidden sm:inline">Give Store</span>
      </a>
    </div>

    <!-- 2. Navegación Principal (Desktop) -->
    <nav class="hidden md:flex items-center space-x-6">
      {
        navLinks.map((link) => (
          <a
            href={link.href}
            class={`
                    text-lg font-medium transition-colors duration-200 
                    ${
                      Astro.url.pathname === link.href ||
                      (link.href !== "/" &&
                        Astro.url.pathname.startsWith(link.href))
                        ? "text-primary font-bold border-b-2 border-primary"
                        : "text-gray-600 hover:text-primary"
                    }
                    pb-1
                `}
            aria-label={link.title}
          >
            {link.title}
          </a>
        ))
      }
    </nav>

    <!-- 3. Barra de Búsqueda (Desktop) - Usa el componente modular SearchInput -->
    <div class="flex-grow max-w-lg mx-4 hidden lg:block">
      <SearchInput />
    </div>

    <!-- 4. Iconos de Navegación Rápida & Botones de Toggle Móvil -->
    <div class="flex items-center gap-4">
      <!-- Icono de Búsqueda (Mobile/Tablet) - Sigue siendo el botón Alpine -->
      <button
        @click="isSearchOpen = !isSearchOpen; isMenuOpen = false"
        :aria-expanded="isSearchOpen"
        class="relative p-2 rounded-full hover:bg-gray-100 transition-colors group lg:hidden"
        aria-label="Abrir Búsqueda Móvil"
      >
        <Icon
          name="mdi:magnify"
          class="w-6 h-6 text-gray-700 group-hover:text-primary"
        />
      </button>

      <!-- Icono de Usuario -->
      <a
        href="/account"
        class="relative p-2 rounded-full hover:bg-gray-100 transition-colors group"
        aria-label="Mi Cuenta"
      >
        <Icon
          name="mdi:account"
          class="w-6 h-6 text-gray-700 group-hover:text-primary"
        />
        <span class="sr-only">Mi Cuenta</span>
      </a>

      <!-- Icono de Carrito -->
      <a
        href="/cart"
        class="relative p-2 rounded-full hover:bg-gray-100 transition-colors group"
        aria-label="Carrito de Compras"
      >
        <Icon
          name="mdi:cart"
          class="w-6 h-6 text-gray-700 group-hover:text-primary"
        />
        {
          cartItemCount > 0 && (
            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">
              {cartItemCount}
            </span>
          )
        }
        <span class="sr-only">Items en el carrito: {cartItemCount}</span>
      </a>

      <!-- Icono de Menú Hamburguesa (Mobile/Tablet) - Sigue siendo el botón Alpine -->
      <button
        @click="isMenuOpen = !isMenuOpen; isSearchOpen = false"
        :aria-expanded="isMenuOpen"
        class="md:hidden p-2 text-gray-600 hover:text-primary"
        aria-label="Abrir menú de navegación"
      >
        <Icon name="mdi:menu" class="w-6 h-6" />
      </button>
    </div>
  </div>

  <!-- 5. Contenedores Desplegables Móviles - Usa el componente MobileDropdowns -->
  <!-- Este componente recibe los enlaces y usa el estado isMenuOpen/isSearchOpen de este header. -->
  <MobileDropdowns navLinks={navLinks} />
</header>
